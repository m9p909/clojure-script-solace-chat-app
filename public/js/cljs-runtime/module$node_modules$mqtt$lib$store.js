shadow$provide.module$node_modules$mqtt$lib$store=function(global,require,module,exports){function Store(options){if(!(this instanceof Store))return new Store(options);this.options=options||{};this.options=xtend(defaultStoreOptions,options);this._inflights=new Map}var xtend=require("module$node_modules$xtend$immutable"),Readable=require("module$node_modules$mqtt$node_modules$readable_stream$readable_browser").Readable,streamsOpts={objectMode:!0},defaultStoreOptions={clean:!0};Store.prototype.put=
function(packet,cb){this._inflights.set(packet.messageId,packet);cb&&cb();return this};Store.prototype.createStream=function(){var stream=new Readable(streamsOpts),destroyed=!1,values=[],i=0;this._inflights.forEach(function(value,key){values.push(value)});stream._read=function(){!destroyed&&i<values.length?this.push(values[i++]):this.push(null)};stream.destroy=function(){if(!destroyed){var self=this;destroyed=!0;setTimeout(function(){self.emit("close")},0)}};return stream};Store.prototype.del=function(packet,
cb){(packet=this._inflights.get(packet.messageId))?(this._inflights.delete(packet.messageId),cb(null,packet)):cb&&cb(Error("missing packet"));return this};Store.prototype.get=function(packet,cb){(packet=this._inflights.get(packet.messageId))?cb(null,packet):cb&&cb(Error("missing packet"));return this};Store.prototype.close=function(cb){this.options.clean&&(this._inflights=null);cb&&cb()};module.exports=Store}
//# sourceMappingURL=module$node_modules$mqtt$lib$store.js.map
