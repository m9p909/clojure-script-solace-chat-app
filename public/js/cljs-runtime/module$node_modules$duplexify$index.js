shadow$provide.module$node_modules$duplexify$index=function(global,require,module,exports){var process=require("module$node_modules$process$browser");global=require("module$node_modules$buffer$index").Buffer;var stream=require("module$node_modules$duplexify$node_modules$readable_stream$readable_browser"),eos=require("module$node_modules$end_of_stream$index");exports=require("module$node_modules$inherits$inherits_browser");var shift=require("module$node_modules$stream_shift$index"),SIGNAL_FLUSH=global.from&&
global.from!==Uint8Array.from?global.from([0]):new global([0]),onuncork=function(self,fn){if(self._corked)self.once("uncork",fn);else fn()},destroyer=function(self,end){return function(err){err?self._autoDestroy&&self.destroy("premature close"===err.message?null:err):end&&!self._ended&&self.end()}},end$jscomp$0=function(ws,fn){if(!ws||ws._writableState&&ws._writableState.finished)return fn();if(ws._writableState)return ws.end(fn);ws.end();fn()},noop=function(){},toStreams2=function(rs){return(new stream.Readable({objectMode:!0,
highWaterMark:16})).wrap(rs)},Duplexify=function(writable,readable,opts){if(!(this instanceof Duplexify))return new Duplexify(writable,readable,opts);stream.Duplex.call(this,opts);this._readable2=this._readable=this._writable=null;this._autoDestroy=!opts||!1!==opts.autoDestroy;this._forwardDestroy=!opts||!1!==opts.destroy;this._forwardEnd=!opts||!1!==opts.end;this._corked=1;this._ondrain=null;this._forwarding=this._drained=!1;this._unread=this._unwrite=null;this.destroyed=this._ended=!1;writable&&
this.setWritable(writable);readable&&this.setReadable(readable)};exports(Duplexify,stream.Duplex);Duplexify.obj=function(writable,readable,opts){opts||(opts={});opts.objectMode=!0;opts.highWaterMark=16;return new Duplexify(writable,readable,opts)};Duplexify.prototype.cork=function(){1===++this._corked&&this.emit("cork")};Duplexify.prototype.uncork=function(){this._corked&&0===--this._corked&&this.emit("uncork")};Duplexify.prototype.setWritable=function(writable){this._unwrite&&this._unwrite();if(this.destroyed)writable&&
writable.destroy&&writable.destroy();else if(null===writable||!1===writable)this.end();else{var self=this,unend=eos(writable,{writable:!0,readable:!1},destroyer(this,this._forwardEnd)),ondrain$jscomp$0=function(){var ondrain=self._ondrain;self._ondrain=null;ondrain&&ondrain()};this._unwrite&&process.nextTick(ondrain$jscomp$0);this._writable=writable;this._writable.on("drain",ondrain$jscomp$0);this._unwrite=function(){self._writable.removeListener("drain",ondrain$jscomp$0);unend()};this.uncork()}};
Duplexify.prototype.setReadable=function(readable){this._unread&&this._unread();if(this.destroyed)readable&&readable.destroy&&readable.destroy();else if(null===readable||!1===readable)this.push(null),this.resume();else{var self=this,unend=eos(readable,{writable:!1,readable:!0},destroyer(this)),onreadable=function(){self._forward()},onend=function(){self.push(null)};this._drained=!0;this._readable=readable;this._readable2=readable._readableState?readable:toStreams2(readable);this._readable2.on("readable",
onreadable);this._readable2.on("end",onend);this._unread=function(){self._readable2.removeListener("readable",onreadable);self._readable2.removeListener("end",onend);unend()};this._forward()}};Duplexify.prototype._read=function(){this._drained=!0;this._forward()};Duplexify.prototype._forward=function(){if(!this._forwarding&&this._readable2&&this._drained){this._forwarding=!0;for(var data;this._drained&&null!==(data=shift(this._readable2));)this.destroyed||(this._drained=this.push(data));this._forwarding=
!1}};Duplexify.prototype.destroy=function(err,cb){cb||(cb=noop);if(this.destroyed)return cb(null);this.destroyed=!0;var self=this;process.nextTick(function(){self._destroy(err);cb(null)})};Duplexify.prototype._destroy=function(err){if(err){var ondrain=this._ondrain;this._ondrain=null;ondrain?ondrain(err):this.emit("error",err)}this._forwardDestroy&&(this._readable&&this._readable.destroy&&this._readable.destroy(),this._writable&&this._writable.destroy&&this._writable.destroy());this.emit("close")};
Duplexify.prototype._write=function(data,enc,cb){if(!this.destroyed){if(this._corked)return onuncork(this,this._write.bind(this,data,enc,cb));if(data===SIGNAL_FLUSH)return this._finish(cb);if(!this._writable)return cb();!1===this._writable.write(data)?this._ondrain=cb:this.destroyed||cb()}};Duplexify.prototype._finish=function(cb){var self=this;this.emit("preend");onuncork(this,function(){end$jscomp$0(self._forwardEnd&&self._writable,function(){!1===self._writableState.prefinished&&(self._writableState.prefinished=
!0);self.emit("prefinish");onuncork(self,cb)})})};Duplexify.prototype.end=function(data,enc,cb){if("function"===typeof data)return this.end(null,null,data);if("function"===typeof enc)return this.end(data,null,enc);this._ended=!0;data&&this.write(data);this._writableState.ending||this._writableState.destroyed||this.write(SIGNAL_FLUSH);return stream.Writable.prototype.end.call(this,cb)};module.exports=Duplexify}
//# sourceMappingURL=module$node_modules$duplexify$index.js.map
